{% extends 'base.html.twig' %}
{% block body %}
    <div class="container is-max-desktop">
        <div class="box">
            {% set actualPercent = (metricsHelper.getLiftedKilogramsTotal() / 66000 * 100)|number_format %}
            Aktualny wagon węgla został rozładowany w {{ actualPercent }}%, {{ (metricsHelper.getLiftedKilogramsTotal() / 1000)|number_format }}/66 ton.
            <progress class="progress is-info" value="{{ actualPercent }}" max="100">{{ actualPercent }}%</progress>
        </div>

        <div>
            <canvas id="myChart"></canvas>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('myChart');

        const data = {
            datasets: [
                {
                    data: {{ metricsHelper.getTotalLiftedWeightPerTraining()|raw }},
                    borderColor: 'rgb(54, 162, 235)',
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                }
            ]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                parsing: {
                    xAxisKey: 'training_date',
                    yAxisKey: 'kilograms_total'
                },
                plugins: {
                    legend: {
                        display: false,
                    },
                    title: {
                        display: true,
                        text: 'Suma podniesionych kilogramów per trening'
                    },
                    datalabels: {
                        color: 'rgb(54, 162, 235)',
                        backgroundColor: '#FFFFFF',
                        align: 'top',
                        formatter: function(value, context) {
                            let $data = $.map(context.dataset.data, function(val) {return val;});

                            return parseInt($data[context.dataIndex]['kilograms_total']);
                        },
                        listeners: {
                            click: function(context, event) {
                                let $trainingId = context['dataset']['data'][context.dataIndex]['training_id'];
                                window.location.href = '/training/' + $trainingId + '/read';
                            }
                        }
                    },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                borderColor: 'rgba(54, 162, 235, 0.5)',
                                scaleID: 'y',
                                value: {{ metricsHelper.getAverageLiftedWeight() }},
                                label: {
                                    display: true,
                                    content: '~ ' + {{ metricsHelper.getAverageLiftedWeight() }},
                                    fontColor: 'rgb(54, 162, 235)',
                                    color: 'rgb(54, 162, 235)',
                                    backgroundColor: "#FFFFFF",
                                }
                            }
                        }
                    }
                }
            }
        };

        Chart.register(ChartDataLabels);
        new Chart(ctx, config);
    </script>
{% endblock %}